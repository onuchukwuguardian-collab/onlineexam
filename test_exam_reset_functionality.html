<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="test-token">
    <title>Exam Reset Functionality Test</title>
    <script src="public/assets/js/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>üîß Exam Reset Functionality Test</h1>
    
    <div class="info status">
        <strong>Test Purpose:</strong> Verify that subjects populate when class is selected
    </div>
    
    <div class="form-group">
        <label for="class_id">Select Class:</label>
        <select id="class_id" name="class_id">
            <option value="">Select Class</option>
            <option value="8">JSS1</option>
            <option value="11">SS1</option>
            <option value="12">SS2</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="subject_id">Select Subject:</label>
        <select id="subject_id" name="subject_id">
            <option value="">Select Subject</option>
        </select>
    </div>
    
    <div id="status"></div>
    
    <script>
        $(document).ready(function() {
            // Setup CSRF token for all AJAX requests
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            
            // Load subjects when class is selected
            $('#class_id').change(function() {
                const classId = $(this).val();
                const subjectSelect = $('#subject_id');
                const statusDiv = $('#status');
                
                subjectSelect.html('<option value="">Loading...</option>');
                statusDiv.html('<div class="info status">Loading subjects...</div>');
                
                if (classId) {
                    $.ajax({
                        url: `/admin/exam-reset/subjects/${classId}`,
                        method: 'GET',
                        headers: {
                            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content'),
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        success: function(subjects) {
                            subjectSelect.html('<option value="">Select Subject</option>');
                            subjects.forEach(function(subject) {
                                subjectSelect.append(`<option value="${subject.id}">${subject.name}</option>`);
                            });
                            
                            statusDiv.html(`<div class="success status">‚úÖ Successfully loaded ${subjects.length} subjects</div>`);
                        },
                        error: function(xhr) {
                            console.error('Error loading subjects:', xhr);
                            subjectSelect.html('<option value="">Error loading subjects</option>');
                            
                            let errorMsg = 'Unknown error';
                            if (xhr.status === 401) {
                                errorMsg = 'Authentication required - please login as admin';
                            } else if (xhr.status === 403) {
                                errorMsg = 'Access denied - admin privileges required';
                            } else if (xhr.responseJSON && xhr.responseJSON.message) {
                                errorMsg = xhr.responseJSON.message;
                            }
                            
                            statusDiv.html(`<div class="error status">‚ùå Error: ${errorMsg} (Status: ${xhr.status})</div>`);
                        }
                    });
                } else {
                    subjectSelect.html('<option value="">Select Subject</option>');
                    statusDiv.html('');
                }
            });
        });
    </script>
</body>
</html>